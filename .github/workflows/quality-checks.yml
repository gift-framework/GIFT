name: Quality Checks (Informational)

# This workflow runs additional quality checks that are INFORMATIONAL ONLY
# They provide useful feedback but do NOT block PRs or commits

on:
  pull_request:
    branches: [ main ]
    paths:
      - '**.py'
  workflow_dispatch:

# Cancel in-progress runs when a new commit is pushed
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  type-check:
    name: Type Check (mypy)
    runs-on: ubuntu-latest
    # This job is informational only - never fails the workflow
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install mypy types-requests
          pip install -r requirements.txt || true

      - name: Run mypy (informational)
        run: |
          echo "Running type checks - these are informational only"
          echo "=================================================="
          mypy --ignore-missing-imports --no-error-summary \
               --exclude 'venv|\.venv|build|dist|__pycache__|\.ipynb_checkpoints' \
               . 2>&1 | head -100 || true
          echo ""
          echo "Type check complete (informational only)"

  import-check:
    name: Import Check
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: pip install -r requirements.txt || true

      - name: Check Python imports
        run: |
          echo "Checking for import errors in Python files..."
          find . -name "*.py" -not -path "*/venv/*" -not -path "*/.venv/*" \
                 -not -path "*/__pycache__/*" -not -path "*/.*" | head -20 | while read pyfile; do
            echo -n "  $pyfile: "
            if python -c "import ast; ast.parse(open('$pyfile').read())" 2>/dev/null; then
              echo "OK"
            else
              echo "SYNTAX ERROR"
            fi
          done

  complexity-report:
    name: Complexity Report
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install radon
        run: pip install radon

      - name: Generate complexity report
        run: |
          echo "Cyclomatic Complexity Report (top 10 most complex functions)"
          echo "============================================================"
          radon cc . -a -s --exclude "venv,.venv,__pycache__,.ipynb_checkpoints" \
                     --total-average 2>&1 | tail -20 || true
          echo ""
          echo "Maintainability Index (files with MI < 20 may need attention)"
          echo "============================================================="
          radon mi . -s --exclude "venv,.venv,__pycache__,.ipynb_checkpoints" \
                     2>&1 | grep -E "^[A-F] " | head -10 || echo "All files have good maintainability"
