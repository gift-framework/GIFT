# GIFT v2.2 Variational G2 Configuration
# =========================================
# Physics-Informed Neural Network for constrained G2 variational problem

# GIFT v2.2 Physical Constants (Primary Constraints)
physics:
  # Topological invariants from E8 decomposition
  b2: 21                    # Second Betti number (harmonic 2-forms)
  b3: 77                    # Third Betti number (35 local + 42 global TCS)
  h_star: 99                # Total cohomological dimension (b2 + b3 + 1)

  # Derived metric constraint
  det_g: 2.03125            # = 65/32, from topological formula
  det_g_exact: "65/32"      # Exact rational value

  # Torsion target
  kappa_T: 0.01639344       # = 1/61, global torsion magnitude
  kappa_T_exact: "1/61"     # Exact rational value

  # G2 geometric constants
  g2_dim: 14                # Dimension of G2 Lie group
  k7_dim: 7                 # Dimension of K7 manifold
  p2: 2                     # Binary duality (dim(G2)/dim(K7) = 14/7)

  # Angular quantization
  beta_0: 0.392699          # = pi/8, from pi/rank(E8)

  # Other GIFT parameters
  weyl_factor: 5            # Pentagonal symmetry
  xi: 0.981748              # = 5*pi/16, correlation parameter

# Network Architecture
model:
  # Input/Output dimensions
  input_dim: 7              # Coordinates on R7
  phi_components: 35        # Independent 3-form components (7 choose 3)

  # Fourier feature encoding
  fourier_features:
    enabled: true
    num_frequencies: 64
    scale: 1.0

  # MLP architecture
  hidden_layers: [256, 512, 512, 256]
  activation: "silu"        # Smooth activation for differentiability

  # Output processing
  output_activation: "none"  # Raw output, positivity enforced separately

  # Positivity projection
  positivity:
    method: "eigenvalue_projection"
    min_eigenvalue: 1e-6

# Training Configuration
training:
  # Phased training protocol
  phases:
    - name: "initialization"
      epochs: 2000
      focus: "establish G2 structure"
      weights:
        torsion: 1.0
        det: 0.5
        positivity: 2.0
        cohomology: 0.0
      lr: 1e-3

    - name: "constraint_satisfaction"
      epochs: 3000
      focus: "satisfy det(g) = 65/32"
      weights:
        torsion: 1.0
        det: 2.0
        positivity: 1.0
        cohomology: 0.1
      lr: 5e-4

    - name: "torsion_targeting"
      epochs: 3000
      focus: "achieve kappa_T = 1/61"
      weights:
        torsion: 3.0
        det: 1.0
        positivity: 1.0
        cohomology: 0.5
      lr: 2e-4

    - name: "cohomology_refinement"
      epochs: 2000
      focus: "refine (b2, b3) = (21, 77)"
      weights:
        torsion: 2.0
        det: 1.0
        positivity: 1.0
        cohomology: 2.0
      lr: 1e-4

  total_epochs: 10000

  # Grid sampling
  grid:
    resolution: 16          # 16^7 = 268M points (sampled stochastically)
    domain: [-1.0, 1.0]     # Periodic domain

  # Batch configuration
  batch_size: 2048
  num_workers: 4

  # Optimizer
  optimizer: "adam"
  weight_decay: 1e-6

  # Learning rate schedule
  lr_schedule:
    type: "cosine_annealing"
    T_max: 10000
    eta_min: 1e-6

  # Gradient clipping
  grad_clip: 1.0

  # Checkpointing
  checkpoint_freq: 500

  # Early stopping
  early_stopping:
    enabled: true
    patience: 1000
    min_delta: 1e-7

# Validation Configuration
validation:
  # Target metrics and tolerances
  metrics:
    det_g:
      target: 2.03125
      tolerance: 0.002       # +/- 0.1%

    kappa_T:
      target: 0.01639344
      tolerance: 0.0008      # +/- 5%

    b2_effective:
      target: 21
      tolerance: 0            # Exact

    b3_effective:
      target: 77
      tolerance: 0            # Exact

    phi_norm_squared:
      target: 7.0            # G2 identity: ||phi||^2_g = 7
      tolerance: 0.07        # +/- 1%

    g_positive:
      target: true           # All eigenvalues > 0
      tolerance: null        # Binary

  # Validation frequency
  eval_freq: 100

  # Grid for validation (denser than training)
  grid_resolution: 32

# Cohomology Extraction
cohomology:
  # Method for extracting harmonic forms
  method: "hodge_decomposition"

  # Numerical parameters
  resolution: 16
  regularization: 1e-8

  # SVD truncation for rank estimation
  svd_threshold: 1e-4

# Output Configuration
output:
  # Directories (relative to variational_g2/)
  checkpoints_dir: "outputs/checkpoints"
  metrics_dir: "outputs/metrics"
  artifacts_dir: "outputs/artifacts"

  # What to save
  save_phi: true            # Save 3-form as neural network weights
  save_metric: true         # Save induced metric g(x)
  save_harmonic_bases: true # Save {omega_alpha} for H2, {Omega_k} for H3
  save_validation: true     # Save all metrics with uncertainties

  # Formats
  model_format: "pt"        # PyTorch format
  data_format: "npz"        # NumPy compressed

# Logging
logging:
  level: "INFO"
  tensorboard: true
  wandb: false
  log_freq: 50

# Reproducibility
seed: 42
deterministic: true
